<!doctype html>
<html>
  <head>
    <title>Tree Hugger SB</title>
    <style type="text/css">
      html, body, #map-canvas { height: 100%; margin: 0; padding: 0;}
    </style>
    <script src="http://maps.google.com/maps/api/js"></script>
<script>
// django csrf
if(!document.cookie.match('csrftoken=[a-zA-Z0-9]{32}')) {
    for(var c = ''; c.length < 32;) c += Math.random().toString(36).substr(2, 1)
    document.cookie = 'csrftoken=' + c + '; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/'
}
</script>
    <script>
      function initialize() {
        var mapOptions = {
          center: { lat: 41.6725, lng: -86.2},
          zoom: 13
        };
        var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
        google.maps.event.addListener(map, 'click', function(event) {
           placeMarker(event.latLng);
        });
        d = new XMLHttpRequest()
        d.open('GET', '/api/v1/tree/?limit=1000&format=json', true)
        d.send()
        d.onload = function(){
            trees = JSON.parse(d.responseText).objects
            trees.forEach(function(tree){
                new google.maps.Marker({
                    position: {lat: tree.latitude, lng: tree.longitude},
                    map: map
                })
            })
        }
        function placeMarker(loc) {
            var marker = new google.maps.Marker({
                position: loc,
                map: map
            });
            var r = new XMLHttpRequest()
            r.open('POST', '/admin/trees/tree/add/', true);
            r.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
            csrf = document.cookie.match('csrftoken=([a-zA-Z0-9]{32})')[1]
            r.send('csrfmiddlewaretoken=' + csrf + '&height=0&latitude=' + loc.lat() + '&longitude=' + loc.lng())
        }
      }
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </head>
  <body>
<div id="map-canvas"></div>
  </body>
</html>
